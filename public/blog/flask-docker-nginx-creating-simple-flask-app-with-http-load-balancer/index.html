<!doctype html><html lang=en data-bs-theme=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=preload href=https://nopedawn.github.io/fonts/vendor/jost/jost-v4-latin-regular.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://nopedawn.github.io/fonts/vendor/jost/jost-v4-latin-500.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://nopedawn.github.io/fonts/vendor/jost/jost-v4-latin-700.woff2 as=font type=font/woff2 crossorigin><script src=https://nopedawn.github.io/js/color-mode.86a91f050a481d0a3f0c72ac26543cb6228c770875981c58dcbc008fd3f875c8.js integrity="sha256-hqkfBQpIHQo/DHKsJlQ8tiKMdwh1mBxY3LwAj9P4dcg="></script><link rel=stylesheet href=https://nopedawn.github.io/main.ee7d3034069aa79eb798b7cd61310a66e3dc02d9a14a44283551f11dc323c18f483af43ababa9e843b1ca06ddd378656f6f9bb84e49b4fa72cc1665fd57ff174.css integrity="sha512-7n0wNAaap563mLfNYTEKZuPcAtmhSkQoNVHxHcMjwY9IOvQ6urqehDscoG3dN4ZW9vm7hOSbT6cswWZf1X/xdA==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><base href=https://nopedawn.github.io/blog/flask-docker-nginx-creating-simple-flask-app-with-http-load-balancer/><link rel=canonical href=https://nopedawn.github.io/blog/flask-docker-nginx-creating-simple-flask-app-with-http-load-balancer/><title>FLASK DOCKER NGINX: Creating Simple Flask App with HTTP Load Balancer | nopedawn</title>
<meta name=description content="Congrats on setting up a new Doks project!"><link rel=icon href=https://nopedawn.github.io/favicon.ico sizes=32x32><link rel=icon href=https://nopedawn.github.io/favicon.svg type=image/svg+xml><link rel=apple-touch-icon href=https://nopedawn.github.io/apple-touch-icon.png sizes=180x180 type=image/png><link rel=icon href=https://nopedawn.github.io/favicon-192x192.png sizes=192x192 type=image/png><link rel=icon href=https://nopedawn.github.io/favicon-512x512.png sizes=512x512 type=image/png><link rel=manifest href=https://nopedawn.github.io/manifest.webmanifest><meta property="og:title" content="FLASK DOCKER NGINX: Creating Simple Flask App with HTTP Load Balancer"><meta property="og:description" content="Introduction Flask is a small and lightweight Python web framework that provides useful tools and features for creating web applications. It&rsquo;s known for its simplicity and flexibility, making it a popular choice among developers."><meta property="og:type" content="article"><meta property="og:url" content="https://nopedawn.github.io/blog/flask-docker-nginx-creating-simple-flask-app-with-http-load-balancer/"><meta property="og:image" content="https://nopedawn.github.io/blog/flask-docker-nginx-creating-simple-flask-app-with-http-load-balancer/cover-flask-docker-nginx.png"><meta property="article:section" content="blog"><meta property="article:published_time" content="2024-04-18T09:16:00+07:00"><meta property="article:modified_time" content="2024-04-18T13:11:00+07:00"><meta property="og:site_name" content="nopedawn"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://nopedawn.github.io/blog/flask-docker-nginx-creating-simple-flask-app-with-http-load-balancer/cover-flask-docker-nginx.png"><meta name=twitter:title content="FLASK DOCKER NGINX: Creating Simple Flask App with HTTP Load Balancer"><meta name=twitter:description content="Introduction Flask is a small and lightweight Python web framework that provides useful tools and features for creating web applications. It&rsquo;s known for its simplicity and flexibility, making it a popular choice among developers."><meta name=twitter:site content="@getdoks"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://nopedawn.github.io/","name":"Nopedawn","position":1},{"@type":"ListItem","item":"https://nopedawn.github.io/blog/","name":"Featured Works","position":2},{"@type":"ListItem","name":"Flask Docker Nginx Creating Simple Flask App With HTTP Load Balancer","position":3}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"BlogPosting","headline":"FLASK DOCKER NGINX: Creating Simple Flask App with HTTP Load Balancer","description":"","isPartOf":{"@id":"https://nopedawn.github.io/blog/flask-docker-nginx-creating-simple-flask-app-with-http-load-balancer/"},"mainEntityOfPage":{"@id":"https://nopedawn.github.io/blog/flask-docker-nginx-creating-simple-flask-app-with-http-load-balancer/"},"datePublished":"2024-04-18T09:16:00+07:00","dateModified":"2024-04-18T13:11:00+07:00","image":[{"@id":"https://nopedawn.github.io/blog/flask-docker-nginx-creating-simple-flask-app-with-http-load-balancer/cover-flask-docker-nginx.png"},{"@id":"https://nopedawn.github.io/blog/flask-docker-nginx-creating-simple-flask-app-with-http-load-balancer/topology-flask-docker-nginx-lb.drawio.png"},{"@id":"https://nopedawn.github.io/blog/flask-docker-nginx-creating-simple-flask-app-with-http-load-balancer/webview-app1.png"},{"@id":"https://nopedawn.github.io/blog/flask-docker-nginx-creating-simple-flask-app-with-http-load-balancer/webview-app2.png"},{"@id":"https://nopedawn.github.io/blog/flask-docker-nginx-creating-simple-flask-app-with-http-load-balancer/webview-app3.png"}],"author":{"@type":"Organization","name":"Hyas","url":"https://nopedawn.github.io"},"publisher":{"@type":"Organization","name":"Hyas"}}]}</script><head><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css integrity="sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w==" crossorigin=anonymous referrerpolicy=no-referrer><style>.blinking-cursor{position:relative}.cursor{animation:blink 1s infinite;user-select:none}.dollar{user-select:none}@keyframes blink{0%{opacity:1}50%{opacity:0}100%{opacity:1}}</style></head></head><body class="single section blog" data-bs-spy=scroll data-bs-target=#toc data-bs-root-margin="0px 0px -60%" data-bs-smooth-scroll=true tabindex=0><div class=sticky-top><header class="navbar navbar-expand-lg"><div class=container-lg><a class="navbar-brand me-auto me-lg-3" href=https://nopedawn.github.io/>nopedawn</a>
<button type=button id=searchToggleMobile class="btn btn-link nav-link mx-2 d-lg-none" aria-label="Search website">
<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg></button>
<button class="btn btn-link nav-link mx-2 order-3 d-lg-none" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasNavMain aria-controls=offcanvasNavMain aria-label="Open main navigation menu"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-menu" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><line x1="4" y1="8" x2="20" y2="8"/><line x1="4" y1="16" x2="20" y2="16"/></svg></button><div class="offcanvas offcanvas-end h-auto" tabindex=-1 id=offcanvasNavMain aria-labelledby=offcanvasNavMainLabel><div class=offcanvas-header><h5 class=offcanvas-title id=offcanvasNavMainLabel>nopedawn</h5><button type=button class="btn btn-link nav-link p-0 ms-auto" data-bs-dismiss=offcanvas aria-label=Close><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-x" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6 6 18"/><path d="M6 6l12 12"/></svg></button></div><div class="offcanvas-body d-flex flex-column flex-lg-row justify-content-between"><ul class="navbar-nav flex-grow-1"><li class=nav-item><a class=nav-link href=https://nopedawn.github.io/portfolio/>Portfolio</a></li><li class=nav-item><a class=nav-link href=https://nopedawn.github.io/posts/>Posts</a></li><li class=nav-item><a class=nav-link href=https://nopedawn.github.io/blog/>Featured Works</a></li></ul><button type=button id=searchToggleDesktop class="btn btn-link nav-link p-2 d-none d-lg-block" aria-label="Search website">
<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg></button>
<button id=buttonColorMode class="btn btn-link mx-auto nav-link p-0 ms-lg-2 me-lg-1" type=button aria-label="Toggle theme"><svg data-bs-theme-value="dark" xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-moon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 3c.132.0.263.0.393.0a7.5 7.5.0 007.92 12.446A9 9 0 1112 2.992z"/></svg><svg data-bs-theme-value="light" xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-sun" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 12m-4 0a4 4 0 108 0 4 4 0 10-8 0m-5 0h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7-.7.7m0 11.4.7.7m-12.1-.7-.7.7"/></svg></button><ul id=socialMenu class="nav mx-auto flex-row order-lg-4"><li class=nav-item><a class="nav-link social-link" href=https://github.com/nopedawn><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg><small class="ms-2 visually-hidden">GitHub</small></a></li><li class=nav-item><a class="nav-link social-link" href=https://www.linkedin.com/in/ramadhandn/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-linkedin" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4m0 2a2 2 0 012-2h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2z"/><path d="M8 11v5"/><path d="M8 8v.01"/><path d="M12 16v-5"/><path d="M16 16v-3a2 2 0 00-4 0"/></svg><small class="ms-2 visually-hidden">LinkedIn</small></a></li></ul></div></div></div></header></div><div class=modal id=searchModal tabindex=-1 aria-labelledby=searchModalLabel aria-hidden=true><div class="modal-dialog modal-dialog-scrollable modal-fullscreen-md-down"><div class=modal-content><div class=modal-header><h1 class="modal-title fs-5 visually-hidden" id=searchModalLabel>Search</h1><button type=button class="btn-close visually-hidden" data-bs-dismiss=modal aria-label=Close></button><div class="search-input flex-grow-1 d-none"><form id=search-form class=search-form action=# method=post accept-charset=UTF-8 role=search><label for=query class=visually-hidden>Search</label><div class=d-flex><input type=search id=query name=query class="search-text form-control form-control-lg" placeholder=Search aria-label=Search maxlength=128 autocomplete=off>
<button type=button class="btn btn-link text-decoration-none px-0 ms-3 d-md-none" data-bs-dismiss=modal aria-label=Close>Cancel</button></div></form></div></div><div class=modal-body><p class="search-loading status message d-none mt-3 text-center">Loading search index…</p><p class="search-no-recent message d-none mt-3 text-center">No recent searches</p><p class="search-no-results message d-none mt-3 text-center">No results for "<strong><span class=query-no-results>Query here</span></strong>"</p><div id=searchResults class=search-results></div><template><article class="search-result list-view"><div class="card my-3"><div class=card-body><header><h2 class="h5 title title-submitted mb-0"><a class="stretched-link text-decoration-none text-reset" href=#>Title here</a></h2><div class="submitted d-none"><time class=created-date>Date here</time></div></header><div class=content>Summary here</div></div></div></article></template></div><div class=modal-footer><ul class="list-inline me-auto d-none d-md-block"><li class=list-inline-item><kbd class=me-2><svg width="15" height="15" aria-label="Enter key" role="img"><g fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M12 3.53088v3c0 1-1 2-2 2H4m3 3-3-3 3-3"/></g></svg></kbd><span class=DocSearch-Label>to select</span></li><li class=list-inline-item><kbd class=me-2><svg width="15" height="15" aria-label="Arrow down" role="img"><g fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M7.5 3.5v8m3-3-3 3-3-3"/></g></svg></kbd><kbd class=me-2><svg width="15" height="15" aria-label="Arrow up" role="img"><g fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M7.5 11.5v-8m3 3-3-3-3 3"/></g></svg></kbd><span class=DocSearch-Label>to navigate</span></li><li class=list-inline-item><kbd class=me-2><svg width="15" height="15" aria-label="Escape key" role="img"><g fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M13.6167 8.936c-.1065.3583-.6883.962-1.4875.962-.7993.0-1.653-.9165-1.653-2.1258v-.5678c0-1.2548.7896-2.1016 1.653-2.1016s1.3601.4778 1.4875 1.0724M9 6c-.1352-.4735-.7506-.9219-1.46-.8972-.7092.0246-1.344.57-1.344 1.2166s.4198.8812 1.3445.9805C8.465 7.3992 8.968 7.9337 9 8.5s-.454 1.398-1.4595 1.398C6.6593 9.898 6 9 5.963 8.4851m-1.4748.5368c-.2635.5941-.8099.876-1.5443.876s-1.7073-.6248-1.7073-2.204v-.4603c0-1.0416.721-2.131 1.7073-2.131.9864.0 1.6425 1.031 1.5443 2.2492h-2.956"/></g></svg></kbd><span class=DocSearch-Label>to close</span></li></ul><p class=d-md-none>Search by <a class=text-decoration-none href=https://github.com/nextapps-de/flexsearch>FlexSearch</a></p></div></div></div></div><div class="wrap container-lg" role=document><div class=content><article><div class="row justify-content-center"><div class="col-md-12 col-lg-10"><div class=blog-header><h1>FLASK DOCKER NGINX: Creating Simple Flask App with HTTP Load Balancer</h1><p><small>April 18, 2024<span class="stretched-link position-relative reading-time text-nowrap" title="Estimated reading time"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 12a9 9 0 1018 0A9 9 0 003 12"/><path d="M12 7v5l3 3"/></svg>7&nbsp;minutes</span></small></p></div></div><div class=col-md-13><picture><source type=image/webp data-srcset="https://nopedawn.github.io/blog/flask-docker-nginx-creating-simple-flask-app-with-http-load-balancer/cover-flask-docker-nginx_huf8e8fb5d99cb3e75b95533eb25dee01c_199197_480x0_resize_q85_h2_lanczos_3.webp 480w,/blog/flask-docker-nginx-creating-simple-flask-app-with-http-load-balancer/cover-flask-docker-nginx_huf8e8fb5d99cb3e75b95533eb25dee01c_199197_576x0_resize_q85_h2_lanczos_3.webp 576w,/blog/flask-docker-nginx-creating-simple-flask-app-with-http-load-balancer/cover-flask-docker-nginx_huf8e8fb5d99cb3e75b95533eb25dee01c_199197_768x0_resize_q85_h2_lanczos_3.webp 768w,/blog/flask-docker-nginx-creating-simple-flask-app-with-http-load-balancer/cover-flask-docker-nginx_huf8e8fb5d99cb3e75b95533eb25dee01c_199197_1025x0_resize_q85_h2_lanczos_3.webp 1025w,/blog/flask-docker-nginx-creating-simple-flask-app-with-http-load-balancer/cover-flask-docker-nginx_huf8e8fb5d99cb3e75b95533eb25dee01c_199197_1200x0_resize_q85_h2_lanczos_3.webp 1200w,/blog/flask-docker-nginx-creating-simple-flask-app-with-http-load-balancer/cover-flask-docker-nginx_huf8e8fb5d99cb3e75b95533eb25dee01c_199197_1280x0_resize_q85_h2_lanczos_3.webp 1280w" data-sizes=auto><img src="data:image/webp;base64,UklGRkoAAABXRUJQVlA4ID4AAADwAQCdASoQAAkAAph8JwBOgCLHnnOxEAAA/tH2lIVaIURL5jupyMk1jN5RwC24b0wAITMkBfEkjY4BRwAAAA==" data-src=https://nopedawn.github.io/blog/flask-docker-nginx-creating-simple-flask-app-with-http-load-balancer/cover-flask-docker-nginx_huf8e8fb5d99cb3e75b95533eb25dee01c_199197_480x0_resize_q85_bgffffff_lanczos_3.jpg width=1280 height=720 decoding=async fetchpriority=auto loading=lazy alt="FLASK DOCKER NGINX: Creating Simple Flask App with HTTP Load Balancer" class="lazyload blur-up img-post-single rounded-0"></picture></div><div class="col-md-12 col-lg-9"><h1 id=introduction>Introduction</h1><p><strong>Flask</strong> is a small and lightweight Python web framework that provides useful tools and features for creating web applications. It&rsquo;s known for its simplicity and flexibility, making it a popular choice among developers.</p><p>Creating a web application with Flask can be quick and straightforward. We can build a web application using only a single Python file. This makes Flask a more accessible framework for new developers.</p><p>Flask doesn&rsquo;t force a particular directory structure or require complicated boilerplate code before getting started. This means we have the freedom to structure project in a way that best suits needs.</p><p>One of the key features of Flask is its extensibility. We can add more functionality to Flask application using extensions. This allows to customize application to fit specific requirements.</p><p>Flask uses the Jinja template engine to dynamically build HTML pages using familiar Python concepts such as variables, loops, lists, and so on. This means it can create dynamic web pages without having to write a lot of JavaScript.</p><p>Before start building a Flask application, we&rsquo;ll need a local <a href=https://www.python.org/downloads/>Python 3</a> programming environment. We&rsquo;ll also need an understanding of Python 3 concepts, such as data types, conditional statements, for loops, functions, and other such concepts.</p><p>Once we&rsquo;ve set up environment, we can install <a href=https://pypi.org/project/Flask/>Flask</a> using the pip package installer. After that, we&rsquo;re ready to start building Flask application.</p><br><h1 id=topology>Topology</h1><p><img src=https://nopedawn.github.io/blog/flask-docker-nginx-creating-simple-flask-app-with-http-load-balancer/topology-flask-docker-nginx-lb.drawio_huad9224c73d8e4922a16101f5d72c4f55_43638_1280x720_resize_q85_h2_lanczos_3.webp width=1280 height=720 decoding=async fetchpriority=auto loading=lazy alt=Topology id=h-rh-i-0></p><ul><li>HTTP Requests: Client requests coming into the Nginx server.</li><li><code>nginx:7151</code>: The Nginx web server listening on port 7151.</li><li><code>app1</code>, <code>app2</code>, <code>app3</code>: These sections are represent the Apps that Nginx can forward requests to <em>(it will automatically give each app a unique port, after building the container)</em>.</li></ul><p>The topology of the project consists of client requests coming into the Nginx server, which is listening on port <code>7151</code>. The Nginx server can forward these requests to multiple Flask applications (<code>app1</code>, <code>app2</code>, <code>app3</code>), each running in its own Docker container. This setup allows for load balancing and efficient distribution of client requests, ensuring that the system can handle a large number of simultaneous connections.</p><br><h1 id=configurations>Configurations</h1><h2 id=project-structure>Project Structure</h2><div class=expressive-code><figure class="frame is-terminal has-title not-content"><figcaption class=header><span class=title>tree</span></figcaption><div class=highlight title=tree><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>flask-docker-nginx-lb
</span></span><span class=line><span class=cl>├── app
</span></span><span class=line><span class=cl>│   ├── Dockerfile
</span></span><span class=line><span class=cl>│   ├── requirements.txt
</span></span><span class=line><span class=cl>│   ├── templates
</span></span><span class=line><span class=cl>│   │   └── index.html
</span></span><span class=line><span class=cl>│   └── wsgi.py
</span></span><span class=line><span class=cl>├── docker-compose.yml
</span></span><span class=line><span class=cl>├── nginx.conf
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=m>2</span> directories, <span class=m>6</span> files</span></span></code></pre></div></figure></div><br><h2 id=requirements>Requirements</h2><div class=expressive-code><figure class="frame has-title not-content"><figcaption class=header><span class=title>requirements.txt</span></figcaption><div class=highlight title=requirements.txt><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=l>flask</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>gunicorn</span></span></span></code></pre></div></figure></div><br><h2 id=docker>DOCKER</h2><div class=expressive-code><figure class="frame has-title not-content"><figcaption class=header><span class=title>Dockerfile</span></figcaption><div class=highlight title=Dockerfile><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=l>FROM python:3.9-slim</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>WORKDIR /app</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>COPY . .</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>RUN pip install -r requirements.txt</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>CMD gunicorn --bind 0.0.0.0:5000 wsgi:app</span></span></span></code></pre></div></figure></div><p>The <code>Dockerfile</code> contains app will create python environment, <code>/app</code> as a working directory, The application&rsquo;s dependencies are listed in a <code>requirements.txt</code> file and include Flask and Gunicorn. Gunicorn will binding on port <code>5000</code>.</p><div class=expressive-code><figure class="frame has-title not-content"><figcaption class=header><span class=title>docker-compose.yml</span></figcaption><div class=highlight title=docker-compose.yml><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;3&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>app</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>build</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>context</span><span class=p>:</span><span class=w> </span><span class=l>app</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;5000&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>nginx</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>nginx:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./nginx.conf:/etc/nginx/nginx.conf:ro</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>app</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;7151:80&#34;</span></span></span></code></pre></div></figure></div><p>The <code>docker-compose.yml</code> file is used to define and run the multi-container Docker app. It specifies the services to run configuration, and the relationships between them. Docker Compose is a tool for defining and managing multi-container Docker apps.</p><br><h2 id=nginx>NGINX</h2><div class=expressive-code><figure class="frame has-title not-content"><figcaption class=header><span class=title>nginx.conf</span></figcaption><div class=highlight title=nginx.conf><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=l>events {</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=l>worker_connections 1000;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>http {</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=l>server {</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=l>listen 80;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=l>location / {</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=l>proxy_pass http://app:5000;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>}</span></span></code></pre></div></figure></div><p>This nginx configuration file sets up Nginx to listen on port <code>80</code> and forward incoming requests to the Flask application running on port <code>5000</code>. Nginx is a high-performance HTTP server and reverse proxy. It&rsquo;s known for its high performance, stability, rich feature set, simple configuration, and low resource consumption.</p><br><h2 id=wsgi>WSGI</h2><div class=expressive-code><figure class="frame has-title not-content"><figcaption class=header><span class=title>wsgi.py</span></figcaption><div class=highlight title=wsgi.py><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span><span class=p>,</span> <span class=n>render_template</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>socket</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s2>&#34;/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>home</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>container_id</span> <span class=o>=</span> <span class=n>socket</span><span class=o>.</span><span class=n>gethostname</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>render_template</span><span class=p>(</span><span class=s2>&#34;index.html&#34;</span><span class=p>,</span> <span class=n>container_id</span><span class=o>=</span><span class=n>container_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>app</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>debug</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span></span></span></code></pre></div></figure></div><p>In the <code>wsgi.py</code> contain a Flask application instance is created and a route is defined for the application’s home page. The home page displays a greeting and the ID of the container the application is running in. This is done using the <code>socket.gethostname()</code> function, which returns the host name of the current system under which the Python interpreter is executed.</p><br><h2 id=templates>Templates</h2><div class=expressive-code><figure class="frame has-title not-content"><figcaption class=header><span class=title>index.html</span></figcaption><div class=highlight title=index.html><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE html&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>html</span> <span class=na>lang</span><span class=o>=</span><span class=s>&#34;en&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>meta</span> <span class=na>charset</span><span class=o>=</span><span class=s>&#34;UTF-8&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>meta</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;viewport&#34;</span> <span class=na>content</span><span class=o>=</span><span class=s>&#34;width=device-width, initial-scale=1.0&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>title</span><span class=p>&gt;</span>Flask App<span class=p>&lt;/</span><span class=nt>title</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;</span>Hello, this is an application<span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;</span>Container ID: {{ container_id }}<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>html</span><span class=p>&gt;</span></span></span></code></pre></div></figure></div><p>The template <code>index.html</code> file is a Jinja template that is rendered by the Flask application. Jinja is a modern and designer-friendly templating language for Python, modelled after Django’s templates. It is fast, widely used and secure with the optional sandboxed template execution environment.</p><br><h2 id=build--run-container>Build & Run container</h2><div class=expressive-code><figure class="frame is-terminal has-title not-content"><figcaption class=header><span class=title>up & running container</span></figcaption><div class=highlight title="up & running container"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker compose up -d --build --scale <span class=nv>app</span><span class=o>=</span><span class=m>3</span>
</span></span><span class=line><span class=cl>WARN<span class=o>[</span>0000<span class=o>]</span> /home/nopedawn/CobaProject/flask-docker-nginx-lb/docker-compose.yml: <span class=sb>`</span>version<span class=sb>`</span> is obsolete
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Building 2.0s <span class=o>(</span>9/9<span class=o>)</span> FINISHED                                                               docker:default
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>[</span>app internal<span class=o>]</span> load build definition from Dockerfile                                                 0.0s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; transferring dockerfile: 171B                                                                     0.0s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>[</span>app internal<span class=o>]</span> load metadata <span class=k>for</span> docker.io/library/python:3.9-slim                                   2.0s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>[</span>app internal<span class=o>]</span> load .dockerignore                                                                    0.0s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; transferring context: 2B                                                                          0.0s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>[</span>app internal<span class=o>]</span> load build context                                                                    0.0s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; transferring context: 163B                                                                        0.0s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>[</span>app 1/4<span class=o>]</span> FROM docker.io/library/python:3.9-slim@sha256:fd8693fc6115345452a19654c1388bc9a1029cda7b9  0.0s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; CACHED <span class=o>[</span>app 2/4<span class=o>]</span> WORKDIR /app                                                                        0.0s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; CACHED <span class=o>[</span>app 3/4<span class=o>]</span> COPY . .                                                                            0.0s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; CACHED <span class=o>[</span>app 4/4<span class=o>]</span> RUN pip install -r requirements.txt                                                 0.0s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>[</span>app<span class=o>]</span> exporting to image                                                                             0.0s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; exporting layers                                                                                  0.0s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; writing image sha256:1ce0f68c7e2794b4afa41a2cb3d2708328e3ee636f6148bda2224eaa4d0d51ca             0.0s
</span></span><span class=line><span class=cl> <span class=o>=</span>&gt; <span class=o>=</span>&gt; naming to docker.io/library/flask-docker-nginx-lb-app                                             0.0s
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Running 4/5
</span></span><span class=line><span class=cl> ⠸ Network flask-docker-nginx-lb_default    Created                                                      1.3s
</span></span><span class=line><span class=cl> ✔ Container flask-docker-nginx-lb-app-3    Started                                                      0.9s
</span></span><span class=line><span class=cl> ✔ Container flask-docker-nginx-lb-app-1    Started                                                      0.6s
</span></span><span class=line><span class=cl> ✔ Container flask-docker-nginx-lb-app-2    Started                                                      0.4s
</span></span><span class=line><span class=cl> ✔ Container flask-docker-nginx-lb-nginx-1  Started                                                      1.1s</span></span></code></pre></div></figure></div><ul><li>This command is used to build, (re)create, start, and attach to containers for a service.</li><li><code>-d</code>: This option is used to run the containers in the background (detached mode).</li><li><code>--build</code>: This option is used to build images before starting containers.</li><li><code>--scale app=3</code>: This option is used to start multiple containers for a service. In this case, it starts 3 instances of the <code>app</code> service. This is useful when we want to scale up application to handle more traffic.</li><li>The output shows the process of building the Docker image for the Flask application, starting the containers for the application and the Nginx server, and creating the network for the Docker Compose project.</li></ul><br><h2 id=view-container-running>View container running</h2><div class=expressive-code><figure class="frame is-terminal has-title not-content"><figcaption class=header><span class=title>view container recently running</span></figcaption><div class=highlight title="view container recently running"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker ps
</span></span><span class=line><span class=cl>CONTAINER ID   IMAGE                       COMMAND                  CREATED         STATUS         PORTS                                         NAMES
</span></span><span class=line><span class=cl>5823d05b8496   nginx:latest                <span class=s2>&#34;/docker-entrypoint.…&#34;</span>   <span class=m>5</span> seconds ago   Up <span class=m>3</span> seconds   0.0.0.0:7151-&gt;80/tcp, :::7151-&gt;80/tcp         flask-docker-nginx-lb-nginx-1
</span></span><span class=line><span class=cl>bd5e7e4c228b   flask-docker-nginx-lb-app   <span class=s2>&#34;/bin/sh -c &#39;gunicor…&#34;</span>   <span class=m>5</span> seconds ago   Up <span class=m>4</span> seconds   0.0.0.0:32777-&gt;5000/tcp, :::32777-&gt;5000/tcp   flask-docker-nginx-lb-app-3
</span></span><span class=line><span class=cl>20a370f16776   flask-docker-nginx-lb-app   <span class=s2>&#34;/bin/sh -c &#39;gunicor…&#34;</span>   <span class=m>5</span> seconds ago   Up <span class=m>4</span> seconds   0.0.0.0:32778-&gt;5000/tcp, :::32778-&gt;5000/tcp   flask-docker-nginx-lb-app-1
</span></span><span class=line><span class=cl>63eb71ad136b   flask-docker-nginx-lb-app   <span class=s2>&#34;/bin/sh -c &#39;gunicor…&#34;</span>   <span class=m>5</span> seconds ago   Up <span class=m>4</span> seconds   0.0.0.0:32779-&gt;5000/tcp, :::32779-&gt;5000/tcp   flask-docker-nginx-lb-app-2</span></span></code></pre></div></figure></div><p>The <code>docker ps</code> command output shows that the Docker Compose project is successfully running four containers. We can see one of these is an Nginx server, which is listening on port <code>7151</code> and is ready to receive incoming HTTP requests. The other three are instances of a Flask application, each running in its own container and listening on a unique port. This setup demonstrates a scalable web application architecture, where an Nginx server acts as a reverse proxy, distributing incoming requests to multiple application instances to balance the load and increase the system&rsquo;s capacity to handle traffic.</p><br><h2 id=web-view>Web View</h2><p><img src=https://nopedawn.github.io/blog/flask-docker-nginx-creating-simple-flask-app-with-http-load-balancer/webview-app1_hu7469b534024ad1f973f13d44b213ed7d_28486_942x518_resize_q85_h2_lanczos_3.webp width=942 height=518 decoding=async fetchpriority=auto loading=lazy alt=webview-app1 id=h-rh-i-1></p><p><img src=https://nopedawn.github.io/blog/flask-docker-nginx-creating-simple-flask-app-with-http-load-balancer/webview-app2_huf0efec8b8e06b223cad7104ed07f0cfd_28345_942x518_resize_q85_h2_lanczos_3.webp width=942 height=518 decoding=async fetchpriority=auto loading=lazy alt=webview-app2 id=h-rh-i-2></p><p><img src=https://nopedawn.github.io/blog/flask-docker-nginx-creating-simple-flask-app-with-http-load-balancer/webview-app3_hu64859323628862a56c7f8a329490a05c_28667_942x518_resize_q85_h2_lanczos_3.webp width=942 height=518 decoding=async fetchpriority=auto loading=lazy alt=webview-app3 id=h-rh-i-3></p><p>We can see in the web display running in the browser on the combined port <code>nginx:7151</code>, look at the container ID section if every time we refresh the value on the container ID will change this indicates that the combined port <code>nginx:7151</code> has successfully forwarded from the three ports app, this load balancer will be very useful in minimizing a lot of traffic to prevent the server from going down.</p><br><h2 id=stopping-the-container>Stopping the container</h2><div class=expressive-code><figure class="frame is-terminal has-title not-content"><figcaption class=header><span class=title>stopping container</span></figcaption><div class=highlight title="stopping container"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker compose down
</span></span><span class=line><span class=cl>WARN<span class=o>[</span>0000<span class=o>]</span> /home/nopedawn/CobaProject/flask-docker-nginx-lb/docker-compose.yml: <span class=sb>`</span>version<span class=sb>`</span> is obsolete
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Running 5/5
</span></span><span class=line><span class=cl> ✔ Container flask-docker-nginx-lb-nginx-1  Removed                                                      0.6s
</span></span><span class=line><span class=cl> ✔ Container flask-docker-nginx-lb-app-3    Removed                                                     10.8s
</span></span><span class=line><span class=cl> ✔ Container flask-docker-nginx-lb-app-1    Removed                                                     11.0s
</span></span><span class=line><span class=cl> ✔ Container flask-docker-nginx-lb-app-2    Removed                                                     10.6s
</span></span><span class=line><span class=cl> ✔ Network flask-docker-nginx-lb_default    Removed                                                      0.6s</span></span></code></pre></div></figure></div><ul><li>This command is used to stop and remove containers, networks, images, and volumes. It&rsquo;s a clean way to ensure that all resources created by <code>docker compose up</code> are removed.</li><li>The output shows the process of stopping and removing the containers for the Flask application and the Nginx server, and removing the network for the Docker Compose project.</li></ul></div></div></article></div></div><footer class="footer text-muted"><div class=container-lg><div class=row><div class="col-lg-8 text-center text-lg-start"><ul class=list-inline><li class=list-inline-item><a class=text-muted href=https://nopedawn.github.io/privacy/>Privacy Policy</a></li></ul></div><div class="col-lg-8 text-center text-lg-end"><ul class=list-inline><li class=list-inline-item>Build by <a class=text-muted href=https://github.com/nopedawn>nopedawn</a></li></ul></div></div></div></footer><script async src=https://nopedawn.github.io/js/app.47b84f3b640408af6efe7bf4add1a36f5b9c6227fbae7b8bcdf0c9ce42fefc54.js integrity="sha256-R7hPO2QECK9u/nv0rdGjb1ucYif7rnuLzfDJzkL+/FQ="></script><script async src=https://nopedawn.github.io/js/flexsearch.4fbcf65295026503d4d24ebe0aaa0bd656946284d6427b8231f61fc71aa40e99.js integrity="sha256-T7z2UpUCZQPU0k6+CqoL1laUYoTWQnuCMfYfxxqkDpk="></script><script async src=https://nopedawn.github.io/js/search-modal.dc7bff7cf660b1cc72b9aa81f4f55343eb1a67a7a4992a48e240c2ad35265c00.js integrity="sha256-3Hv/fPZgscxyuaqB9PVTQ+saZ6ekmSpI4kDCrTUmXAA="></script></body></html>